# Pre-commit hooks configuration for Auto-Author
# Install: pip install pre-commit && pre-commit install
# Run manually: pre-commit run --all-files

repos:
  # Auto-sync documentation with bd tracker
  - repo: local
    hooks:
      - id: export-current-sprint
        name: Export Current Sprint from bd
        entry: ./scripts/export-current-sprint.sh
        language: system
        pass_filenames: false
        always_run: true
        stages: [commit]
        verbose: true

      - id: export-implementation-plan
        name: Export Implementation Plan from bd
        entry: ./scripts/export-implementation-plan.sh
        language: system
        pass_filenames: false
        always_run: true
        stages: [commit]
        verbose: true

      - id: auto-add-exports
        name: Auto-add exported documentation files
        entry: bash -c 'git add CURRENT_SPRINT.md IMPLEMENTATION_PLAN.md 2>/dev/null || true'
        language: system
        pass_filenames: false
        always_run: true
        stages: [commit]

  # Frontend testing
  - repo: local
    hooks:
      - id: frontend-lint
        name: Frontend Linting
        entry: bash -c 'cd frontend && npm run lint'
        language: system
        files: ^frontend/
        pass_filenames: false

      - id: frontend-typecheck
        name: Frontend Type Checking
        entry: bash -c 'cd frontend && npm run typecheck'
        language: system
        files: ^frontend/
        pass_filenames: false

  # Backend testing
  - repo: local
    hooks:
      - id: backend-lint
        name: Backend Linting (ruff)
        entry: bash -c 'cd backend && uv run ruff check app/ tests/ || true'
        language: system
        files: ^backend/
        pass_filenames: false

  # General code quality
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
        exclude: '\.md$'
      - id: end-of-file-fixer
        exclude: '\.md$'
      - id: check-yaml
        exclude: '^\.github/workflows/'
      - id: check-json
      - id: check-merge-conflict
      - id: check-added-large-files
        args: ['--maxkb=1000']
      - id: detect-private-key
      - id: mixed-line-ending

# Configuration
default_install_hook_types: [pre-commit, commit-msg]
default_stages: [commit]
fail_fast: false
